appId: ${MAESTRO_APP_ID}
---
- killApp
- launchApp:
    clearState: false
    arguments:
      email: ${MAESTRO_TEST_EMAIL}
      password: ${MAESTRO_TEST_PASSWORD}
      useMaestroInit: "true"

- assertVisible:
    id: "search-button"
- killApp

# --- First deeplink (Artist) ---
- repeat:
    while:
      notVisible: "KAWS"
    times: 3
    commands:
      - openLink:
          link: https://artsy.net/artist/kaws
          autoVerify: true
      # If Safari steals it, bail out and retry
      - runFlow:
          when:
            visible: "Safari"
          commands:
            - pressKey: home
      - waitForAnimationToEnd:
          timeout: 2000

- extendedWaitUntil:
    visible: "KAWS"
    timeout: 20000

- killApp

# --- Second deeplink (Auction Highlights) ---
- repeat:
    while:
      notVisible: "Highlights at Auction This Week"
    times: 3
    commands:
      - openLink:
          link: https://click.artsy.net/f/a/epPWiX0dJaHHMiXAnSrzSg~~/AAQRxQA~/RgRj95QSP0SQaHR0cHM6Ly93d3cuYXJ0c3kubmV0L2NvbGxlY3Rpb24vYXVjdGlvbi1oaWdobGlnaHRzP3V0bV9zb3VyY2U9YnJhemUmdXRtX21lZGl1bT1lbWFpbCZ1dG1fY2FtcGFpZ249bnRmJnV0bV90ZXJtPTYyMTRmYjlkZWI0ZWZkN2RiNjBjZTcwNDk1NWU4NDQ1VwNzcGNCCmIFEg8VYlEJKGBSEmJyaWJlY2sxQGdtYWlsLmNvbVgEAAAAfw~~
          autoVerify: true
      - runFlow:
          when:
            visible: "Safari"
          commands:
            - pressKey: home
      - waitForAnimationToEnd:
          timeout: 2000

- extendedWaitUntil:
    visible: "Highlights at Auction This Week"
    timeout: 20000

- killApp

# --- Third deeplink (Email link) ---
- repeat:
    while:
      notVisible: "Thoughts For The Free life #5 (The Whole Universe Surrenders), 2022"
    times: 3
    commands:
      - openLink:
          link: https://email-link.artsy.net/ls/click?upn=u001.XPbk8dXjc6dwd18Yq2uPM3eTWB4YbDUmeJTAXXTF512Nwxf-2FNcpcL5kGUjxOn0XjmNvG5yw2nVNZFI2le1Yx0w-3D-3DfZ1B_3Lcd1TF7D-2Bbgka3PNFgpIkcP2iHX23um7pkF2BCyljnib6N1sJsV-2BGlxlczyxod9rh2aScuXtPYUKaXhSrtEbUV4jQc1T3YnSWxnG96wRpa5KMlddofCuChfU9NmzxJrAC2dKNpz2KMYEDe3SXt-2BJLXpXrVUh9yeYxbwbRCm40X9N0g7qF5EkiIVDzUtdtotNJaYJEPW0cE9TIW8pFb7HqJBbMdblMaPdBelnX1zVgu2BP4tLUUrC2gxUmkiciwrDDtsDafwb8LYuopweJglNNVa75ptBoGjeR7wDCel1Ulf-2F0eKvL5GWxKDKimg-2B5Wmer60b4Pp0viUM1VXYJmknDBhuvH92ylAztTEKaH31kR65P5dadVftk7HnhiAzLX0Ax39kX2elwCodt8b-2FEkr9g-3D-3D
          autoVerify: true
      - runFlow:
          when:
            visible: "Safari"
          commands:
            - pressKey: home
      - waitForAnimationToEnd:
          timeout: 2000

- scrollUntilVisible: # we do this just to give time to fetch deeplink verifications, can get rid of if we have a test run before deeplinks on same sim
    element: "Untitled, 2019"
    timeout: 90000
    speed: 60
