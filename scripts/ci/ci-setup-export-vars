
#!/usr/bin/env bash
set -euxo pipefail


LOCAL_BRANCH=$(git rev-parse --abbrev-ref HEAD)
export LOCAL_BRANCH

# ios
export WORKSPACE="ios/Artsy.xcworkspace"
export SCHEME="Artsy"
export DEVICE_HOST_PLAT="iOS Simulator"
export DEVICE_HOST_OS="18.1"
export DEVICE_HOST_NAME="iPhone 16 Pro"
export DERIVED_DATA_PATH="derived_data"
export CONFIGURATION="Release"

# Configure ccache if available
if command -v ccache >/dev/null 2>&1; then
  # Common ccache settings
  export CCACHE_DIR="${CCACHE_DIR:-~/.ccache}"
  export CCACHE_MAXSIZE="${CCACHE_MAXSIZE:-5G}"
  export CCACHE_CPP2=yes
  export CCACHE_SLOPPINESS=pch_defines,time_macros,include_file_mtime

  # Platform-specific compiler settings
  if [[ "$LOCAL_BRANCH" == *"ios"* ]] || [[ "$LOCAL_BRANCH" == "app_store_submission" ]]; then
    # iOS-specific settings
    export CC="${CC:-ccache clang}"
    export CXX="${CXX:-ccache clang++}"
    
    # Log ccache stats before build
    ccache -s
  elif [[ "$LOCAL_BRANCH" == *"android"* ]]; then
    # Android-specific settings
    export NDK_CCACHE="${NDK_CCACHE:-/usr/bin/ccache}"
    
    # Log ccache stats before build
    ccache -s
  fi
fi
