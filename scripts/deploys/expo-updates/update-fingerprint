#!/bin/bash

# === CONFIG ===
IOS_PLIST_PATH="ios/Artsy/Supporting/Expo.plist"
IOS_QA_PLIST_PATH="ios/Artsy/Supporting/QA/ExpoQA.plist"
ANDROID_STRINGS_PATH="android/app/src/main/res/values/strings.xml"

native_fingerprint=$(npx @expo/fingerprint fingerprint:generate | jq -r '.hash')

echo "Updating iOS Expo.plist with runtimeVersion = $native_fingerprint"
/usr/libexec/PlistBuddy -c "Set :EXUpdatesRuntimeVersion $native_fingerprint" "$IOS_PLIST_PATH"

echo "Updating iOS ExpoQA.plist with runtimeVersion = $native_fingerprint"
/usr/libexec/PlistBuddy -c "Set :EXUpdatesRuntimeVersion $native_fingerprint" "$IOS_QA_PLIST_PATH"

echo "Updating Android AndroidManifest.xml with runtimeVersion = $native_fingerprint"
sed -i '' "s|\(<string name=\"expo_runtime_version\">\)[^<]*\(</string>\)|\1$native_fingerprint\2|" "$ANDROID_STRINGS_PATH"

echo -e "\033[0;32mRuntime version updated successfully in both platforms.\033[0m"